<!doctype html><html prefix="og: http://ogp.me/ns#" lang=en><head itemscope itemtype=https://schema.org/Blog><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title itemprop=name>Rgeo — A Go package for basic, fast, local reverse geocoding | Sam Smith</title>
<meta property="og:title" content="Rgeo — A Go package for basic, fast, local reverse geocoding | Sam Smith"><meta itemprop=name content="Rgeo — A Go package for basic, fast, local reverse geocoding | Sam Smith"><meta name=application-name content="Rgeo — A Go package for basic, fast, local reverse geocoding | Sam Smith"><meta property="og:site_name" content="Sam Smith's Blog"><meta name=description content="My blog! I write about (mostly analog) photography and (mostly golang)
programming
"><meta itemprop=description content="My blog! I write about (mostly analog) photography and (mostly golang)
programming
"><meta property="og:description" content="My blog! I write about (mostly analog) photography and (mostly golang)
programming
"><base href=https://samsm.ch/rgeo/><link rel=canonical href=https://samsm.ch/rgeo/ itemprop=url><meta name=url content="https://samsm.ch/rgeo/"><meta name=twitter:url content="https://samsm.ch/rgeo/"><meta property="og:url" content="https://samsm.ch/rgeo/"><link rel=me href=https://toot.io/@mondoman712><link rel=me href=https://github.com/sams96><link rel=webmention href=https://webmention.io/samsm.ch/webmention><link rel=sitemap type=application/xml title=Sitemap href=https://samsm.ch/sitemap.xml><meta property="og:locale" content="en"><meta name=language content="English"><link rel=alternate hreflang=en href=https://samsm.ch/rgeo/ title=English><link rel=icon type=image/x-icon href=https://samsm.ch/favicon.ico><link rel=apple-touch-icon-precomposed href=https://samsm.ch/favicon.png><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta property="og:updated_time" content=2020-03-01T00:00:00Z><style>:root{--color-grey:#595959}@font-face{font-family:cmu;font-style:normal;src:url(https://cdn.jsdelivr.net/gh/dreampulse/computer-modern-web-font/font/Serif/cmunrm.woff)format("woff");font-display:swap}@font-face{font-family:cmu;font-weight:700;src:url(https://cdn.jsdelivr.net/gh/dreampulse/computer-modern-web-font/font/Serif/cmunbx.woff)format("woff");font-display:swap}@font-face{font-family:cmu;font-style:italic;src:url(https://cdn.jsdelivr.net/gh/dreampulse/computer-modern-web-font/font/Serif/cmunti.woff)format("woff");font-display:swap}html{font-family:cmu,georgia,serif}body{background:#fff;color:#333;line-height:1.5;max-width:38em;margin:0 auto;text-align:justify;overflow:auto}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}.container{}h1{font-size:2.6667em}h2{font-size:1.3em;margin-bottom:0}h3{font-size:1em;margin-bottom:0}h1,h2,h3{text-justify:none}a{color:#1d60a3;text-decoration:none}a:active,a:hover{outline:0}a:hover,a:focus{border-bottom:1px solid rgba(163,29,29,.5)}a:active{color:#a31d1d;opacity:.9;border-bottom:1px solid rgba(163,29,29,.5)}.table-wrapper{overflow-x:auto}table{margin:1em auto;width:95%;border-spacing:0;border-collapse:collapse}thead{border-bottom:thin solid #000}th,td{padding:.25em}caption{margin:0 auto;font-style:italic}pre{padding:1em;background-color:#fff;max-width:100%;white-space:pre-wrap;word-break:keep-all}code,pre,kbd{font-family:computer modern typewriter,monospace;line-height:154%;text-align:left;font-size:16px}blockquote{border-left:2px solid #ccc;padding:.1em 1em;margin-left:.75em;padding-right:.1em}figcaption{font-style:italic}footer.bq{font-style:normal;float:right;margin-right:3em;border-top:none;margin-top:1.2em}p{text-indent:0;margin-top:.5em;margin-bottom:0}p:not(:empty)+p:not(:empty){margin-top:0;text-indent:2em}hr{height:1px;border:0;border-top:1px solid #ccc}ul ol,ol ol,ul ul{margin:0 2em}figcaption{display:block;color:var(--color-grey);line-height:1em;margin-bottom:1.5em;font-weight:200}header{display:flex;align-items:center;justify-content:space-between}header h1{font-size:1em;margin-top:1em;margin-bottom:0;font-weight:400}header h2{font-size:1em;margin:0;font-weight:400}header nav{margin-top:3em;max-width:100%;text-align:right;vertical-align:bottom;margin-bottom:0}header nav a{margin-left:2em}header a{color:#333}.site-title{font-size:2em;white-space:nowrap;font-weight:700}.site-header{border-bottom:thin solid #f1f1f1;margin-bottom:2em}main h1{margin-top:1em;font-weight:400;line-height:1.1em;margin-bottom:.5em;font-weight:600}.post-short-list:first-of-type{margin-top:1em}article:not(:last-of-type){padding-bottom:1em}.post-fist:not(:first-of-type):before,.post-list:not(:last-of-type):after{display:block;content:"";width:5em;height:1px;margin:0 auto;margin-top:1em;background-color:#d1d1d1}article header h1{font-size:1.35em;line-height:1.1em;margin-bottom:.5em;font-weight:600}article header h1 a{border:none;text-decoration:none;color:#333}.article-info{font-size:.75em;color:var(--color-grey);margin-top:.25em;text-align:left}.post .article-info{margin-top:2em}.article-info a{color:var(--color-grey)}.article-info a:hover{color:#a31d1d}.post-short-list .article-info{margin-top:0;margin-bottom:1.5em}.article-taxonomies{display:inline}.article-date{white-space:nowrap;font-size:.75em;color:var(--color-grey);font-style:italic}.article-categories{display:inline;list-style-type:none;padding:0}.article-categories li{display:inline;margin-right:1em}.article-tags{display:inline;list-style-type:none;padding:0;margin:0}.article-tags li{display:inline;margin-right:1em}article img{max-width:100%;width:100%;display:block;height:auto;margin:1rem auto}article figure{max-width:100%;display:block;height:auto;margin:0 auto .5em}.diptych figure{margin:0}article img+p:not(:empty),article figure+p:not(:empty),.diptych+p:not(:empty){margin-top:1em}article p:not(:empty)+img,article p:not(:empty)+figure,article p:not(:empty)+.diptych{margin-top:1em}.content>figure:first-child,.content>.diptych:first-child{margin-top:.5em}.read-more{font-size:.75em;margin-top:auto;margin-bottom:0;margin-left:auto;text-align:right;white-space:nowrap}.post-list-footer{display:flex;justify-content:space-between;margin-top:.5em}.divider{display:block;height:1px;border:0;border-top:thin solid #f1f1f1;width:25%;margin:1em auto}.terms{list-style-type:none;padding:0;line-height:2em}.pagination{display:flex;justify-content:space-between;margin-top:1em}.pagination{text-align:center}.pagination-item{background:#fafafa;padding:.5em .75em}.disabled{visibility:hidden}.pagination-item a{color:#333}.pagination-item a:hover,.pagination-item a:focus{color:#a31d1d;border-bottom:0}footer{margin-top:3em;font-size:16px}.site-footer{border-top:thin solid #f1f1f1;display:flex;justify-content:space-between;margin-top:.5em}footer nav{max-width:100%;text-align:right;margin-top:.5em;margin-bottom:.5em}footer nav a{margin-left:2em}footer a{color:#333}@media(max-width:840px){.main-wrapper{margin:0;max-width:none;overflow-x:hidden;padding-left:25px;padding-right:25px}.container{max-width:90%;margin:0 auto}.pagination-item{padding:.5em;font-size:14px}header{display:block}.site-header{text-align:center}header nav{margin-top:1em;max-width:100%;text-align:center;background:#fafafa;padding:.5em 0}header nav a:first-of-type{margin-left:0}header nav a{margin-left:5%}}.diptych{display:block;width:89em;margin:0 auto .5em;position:relative;right:21.5em;overflow:auto}.diptych img{height:auto;width:42em;box-sizing:border-box;float:left;margin:0 .25em 0}@media only screen and (max-width:88em){.diptych{width:100%;position:static}.diptych img{margin:0 auto .5em}}#mastodon-stats{display:none}#mastodon-comments-list{font-family:sans-serif;--font-size:12px;margin-top:12px!important}#mastodon-comments:before{display:block;content:"";width:5em;height:1px;margin:0 auto;margin-top:1em;background-color:#d1d1d1}#mastodon-comments{--comment-padding:1em}</style><base href=https://samsm.ch/rgeo/><link rel=canonical href=https://samsm.ch/rgeo/ itemprop=url><meta name=url content="https://samsm.ch/rgeo/"><meta property="og:url" content="https://samsm.ch/rgeo/"><meta name=google-site-verification content="iL6kgZOem7Wh12HPO2MFqCKL-KH5Jc7vJSdvVBDAZhQ"></head><body><div class=container><header class=site-header><h1 class=site-title><a href=https://samsm.ch/>Sam Smith</a></h1><nav><a href=/posts/ title>Archive</a>
<a href=/about/ title=About>About</a></nav></header><main id=main><article class=post><header><h1>Rgeo — A Go package for basic, fast, local reverse geocoding</h1></header><div class=article-date>01 Mar 2020</div><div class=content><p><a href=https://github.com/sams96/rgeo>Rgeo</a> is a fast, simple solution for local
reverse geocoding, Rather than relying on external software or online APIs, rgeo
packages all of the data it needs in your binary. This means it will only ever
work down to the level of cities , but if that&rsquo;s all you need then this is the
library for you.</p><p>Rgeo uses data from <a href=https://naturalearthdata.com>naturalearthdata.com</a>, if
your coordinates are going to be near specific borders I would advise checking
the data beforehand (links to which are in the files). If you want to use your
own dataset, check out
<a href=https://github.com/sams96/rgeo/tree/master/datagen>datagen</a>.</p><h2 id=key-features>Key Features</h2><ul><li><strong>Fast</strong> - So I haven&rsquo;t <em>actually</em> benchmarked other reverse geocoding tools
but on my laptop rgeo can run at under 800ns/op.</li><li><strong>Local</strong> - Rgeo doesn&rsquo;t require pinging some API, most of which either cost
money to use or have severe rate limits.</li><li><strong>Lightweight</strong> - The rgeo repo is 141MB, which is large for a Go package but
compared to the 800GB needed for a full planet install of
<a href=https://nominatim.org/release-docs/latest/admin/Installation/#hardware>Nominatim</a>
it&rsquo;s miniscule.</li></ul><h2 id=installation>Installation</h2><p>Download with</p><pre><code>go get github.com/sams96/rgeo
</code></pre><p>and add</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=font-weight:700>import</span> <span style=color:#b84>&#34;github.com/sams96/rgeo&#34;</span>
</span></span></code></pre></div><p>to the top of your Go file to include it in your project.</p><h2 id=usage>Usage</h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>r, err <span style=font-weight:700>:=</span> <span style=color:#900;font-weight:700>New</span>(Provinces10, Cities10)
</span></span><span style=display:flex><span><span style=font-weight:700>if</span> err <span style=font-weight:700>!=</span> <span style=font-weight:700>nil</span> {
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// Handle error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>loc, err <span style=font-weight:700>:=</span> r.<span style=color:#900;font-weight:700>ReverseGeocode</span>([]<span style=color:#458;font-weight:700>float64</span>{<span style=color:#099>141.35</span>, <span style=color:#099>43.07</span>})
</span></span><span style=display:flex><span><span style=font-weight:700>if</span> err <span style=font-weight:700>!=</span> <span style=font-weight:700>nil</span> {
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// Handle error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fmt.<span style=color:#900;font-weight:700>Println</span>(loc)
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>// Output: &lt;Location&gt; Sapporo, Hokkaido, Japan (JPN), Asia</span>
</span></span></code></pre></div><p>First initialise rgeo using <code>rgeo.New</code>,</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=font-weight:700>func</span> <span style=color:#900;font-weight:700>New</span>(datasets <span style=font-weight:700>...</span><span style=font-weight:700>func</span>() []<span style=color:#458;font-weight:700>byte</span>) (<span style=font-weight:700>*</span>Rgeo, <span style=color:#458;font-weight:700>error</span>)
</span></span></code></pre></div><p>which takes any non-zero number of datasets as arguments. The included datasets
are:</p><ul><li><code>Countries110</code> - Just country information, smallest and lowest detail of the
included datasets.</li><li><code>Countries10</code> - The same as above but with more detail.</li><li><code>Provinces10</code> - Includes province information as well as country, so can
still be used alone.</li><li><code>Cities10</code> - Just city information, if you want provinces and/or countries as
well use one of the above datasets with it.
Once initialised you can use <code>ReverseGeocode</code> on the value returned by <code>New</code>,
with your coordinates to get the location information. See the <a href=https://pkg.go.dev/github.com/sams96/rgeo>Go
Docs</a> for more information on usage.</li></ul><p>Then use <code>ReverseGeocode</code> to get the location information of the given coordinate.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=font-weight:700>func</span> (r <span style=font-weight:700>*</span>Rgeo) <span style=color:#900;font-weight:700>ReverseGeocode</span>(loc geom.Coord) (Location, <span style=color:#458;font-weight:700>error</span>)
</span></span></code></pre></div><p>The input is a <a href=https://github.com/twpayne/go-geom><code>geom.Coord</code></a>, which is just
a <code>[]float64</code> with the longitude in the zeroth position and the latitude in the
first position (i.e. <code>[]float64{lon, lat}</code>). <code>ReverseGeocode</code> returns a
<code>Location</code>, which looks like this:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=font-weight:700>type</span> Location <span style=font-weight:700>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// Commonly used country name</span>
</span></span><span style=display:flex><span>	Country <span style=color:#458;font-weight:700>string</span> <span style=color:#b84>`json:&#34;country,omitempty&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// Formal name of country</span>
</span></span><span style=display:flex><span>	CountryLong <span style=color:#458;font-weight:700>string</span> <span style=color:#b84>`json:&#34;country_long,omitempty&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// ISO 3166-1 alpha-1 and alpha-2 codes</span>
</span></span><span style=display:flex><span>	CountryCode2 <span style=color:#458;font-weight:700>string</span> <span style=color:#b84>`json:&#34;country_code_2,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	CountryCode3 <span style=color:#458;font-weight:700>string</span> <span style=color:#b84>`json:&#34;country_code_3,omitempty&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	Continent <span style=color:#458;font-weight:700>string</span> <span style=color:#b84>`json:&#34;continent,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	Region    <span style=color:#458;font-weight:700>string</span> <span style=color:#b84>`json:&#34;region,omitempty&#34;`</span>
</span></span><span style=display:flex><span>	SubRegion <span style=color:#458;font-weight:700>string</span> <span style=color:#b84>`json:&#34;subregion,omitempty&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	Province <span style=color:#458;font-weight:700>string</span> <span style=color:#b84>`json:&#34;province,omitempty&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// ISO 3166-2 code</span>
</span></span><span style=display:flex><span>	ProvinceCode <span style=color:#458;font-weight:700>string</span> <span style=color:#b84>`json:&#34;province_code,omitempty&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	City <span style=color:#458;font-weight:700>string</span> <span style=color:#b84>`json:&#34;city,omitempty&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>So, to put it all together:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>r, err <span style=font-weight:700>:=</span> rgeo.<span style=color:#900;font-weight:700>New</span>(Countries110)
</span></span><span style=display:flex><span><span style=font-weight:700>if</span> err <span style=font-weight:700>!=</span> <span style=font-weight:700>nil</span> {
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// Handle error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>loc, err <span style=font-weight:700>:=</span> r.<span style=color:#900;font-weight:700>ReverseGeocode</span>([]<span style=color:#458;font-weight:700>float64</span>{<span style=color:#099>0</span>, <span style=color:#099>52</span>})
</span></span><span style=display:flex><span><span style=font-weight:700>if</span> err <span style=font-weight:700>!=</span> <span style=font-weight:700>nil</span> {
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>// Handle error</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fmt.<span style=color:#900;font-weight:700>Printf</span>(<span style=color:#b84>&#34;%s\n&#34;</span>, loc.Country)
</span></span><span style=display:flex><span>fmt.<span style=color:#900;font-weight:700>Printf</span>(<span style=color:#b84>&#34;%s\n&#34;</span>, loc.CountryLong)
</span></span><span style=display:flex><span>fmt.<span style=color:#900;font-weight:700>Printf</span>(<span style=color:#b84>&#34;%s\n&#34;</span>, loc.CountryCode2)
</span></span><span style=display:flex><span>fmt.<span style=color:#900;font-weight:700>Printf</span>(<span style=color:#b84>&#34;%s\n&#34;</span>, loc.CountryCode3)
</span></span><span style=display:flex><span>fmt.<span style=color:#900;font-weight:700>Printf</span>(<span style=color:#b84>&#34;%s\n&#34;</span>, loc.Continent)
</span></span><span style=display:flex><span>fmt.<span style=color:#900;font-weight:700>Printf</span>(<span style=color:#b84>&#34;%s\n&#34;</span>, loc.Region)
</span></span><span style=display:flex><span>fmt.<span style=color:#900;font-weight:700>Printf</span>(<span style=color:#b84>&#34;%s\n&#34;</span>, loc.SubRegion)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>// Output: United Kingdom</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>// United Kingdom of Great Britain and Northern Ireland</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>// GB</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>// GBR</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>// Europe</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>// Europe</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic>// Northern Europe</span>
</span></span></code></pre></div><h2 id=projects-using-rgeo>Projects using rgeo</h2><p>Currently the only project that I know of is my own
<a href=https://github.com/sams96/rgeoSrv>rgeoSrv</a>, which aims to wrap rgeo into a
microservice. I am also planning on writing a command line appication to apply
IPTC location tags to images that already contain geolocation information.</p><h2 id=how-it-works>How it works</h2><p>The data used by rgeo is made from a collection of GeoJSON files aquired from
<a href=https://github.com/nvkelso/natural-earth-vector/tree/master/geojson>Natural Earth
Data</a>,
which are packaged into Go files by
<a href=https://github.com/sams96/rgeo/tree/master/datagen>datagen</a>. The go files
contain functions which return byte slices that contain the base 64 encoded,
gzipped GeoJSON files. They&rsquo;re packaged into function because that seems to be
the only way to have the Go compiler ignore them if they aren&rsquo;t used (so your
program isn&rsquo;t inflated by huge data files that you aren&rsquo;t using).</p><p><code>New</code> takes the datasets, decodes the data and parses the GeoJSON. It creates an
<code>Rgeo</code> struct which contains an <a href=https://github.com/golang/geo>s2</a> shape index,
a map to store the location information of each area and an s2 contains point
query. The shape index contains s2 polygons for each of the areas in the given
dataset, and the contains point query is what goes from the input coordinates to
a shape. The map is then used to get the location information from the shape.</p><p>One thing I discovered through working on this is initialising s2 loops and
polygons is very slow and there&rsquo;s no way to store them that doesn&rsquo;t have to run
all the validation code upon loading them. I found that going from creating the
s2 types every time to using geom&rsquo;s <code>IsPointInRing</code> function yields a ~100x
speed increase. I used s2 types because I wrote rgeo to be used many times in a
program rather than a few, and s2&rsquo;s contains point query is <em>very</em> fast
(although I don&rsquo;t have any benchmarks to hand).</p></div><div class=article-info><div class=article-taxonomies><ul class=article-categories><li><a href=https://samsm.ch/categories/programming>programming</a></li></ul><ul class=article-tags><li><a href=https://samsm.ch/tags/golang>#golang</a></li><li><a href=https://samsm.ch/tags/rgeo>#rgeo</a></li></ul></div></div><meta name=fediverse:creator content="@mondoman712@toot.io"></article></main><footer class=site-footer><p>© Sam Smith, 2026</p><nav><a href=/tags/ title=Tags>Tags</a>
<a href=/categories/ title=Categories>Categories</a></nav></footer></div></body></html>